% script for testing group norm

% Load data
s_ref = single(rgbtogrey(stdimage('lena')))/255;
s_low = imresize(s_ref,.5);


% Construct initial dictionary
% Load dictionary
load('Flicker20im34dictcold_dict.mat');

[sh_low,sl_low] = lowpass(


opt = [];
opt.Verbose = 1;
opt.rho = 150;
opt.AutoRho = 1;
opt.AutoRhoPeriod = 10;
opt.MaxMainIter =100;
opt.RelStopTol = 1e-3;
opt.L1Weight = ones(size(sh));
opt.L1Weight(box_lu(1):box_rd(1), box_lu(2):box_rd(2)) = 0;
opt.L1Weight(85:92,:) = 0;

lambda = 1;
mu = .2;
g = zeros(size(sh));
g(box_lu(1):box_rd(1), box_lu(2):box_rd(2))  = 1; %group the box into one 
g(96:98,:) = 2;


[x1,~] = cbpdngrp(D,sh,lambda,mu,g,opt);
opt.L1Weight = 1;
lambda = mu; 
[x2,~] = cbpdn(D,sh,lambda,opt);


% Visualization
scnv = @(d,x) ifft2(sum(bsxfun(@times, fft2(d, size(x,1), size(x,2)), ...
                               fft2(x)),3), 'symmetric');
shrec1 = scnv(D,x1);
shrec2 = scnv(D,x2);
srec1 = shrec1;
srec2 = shrec2;

figure;
imagesc(srec1);
title('reconstruction from group norm');
colorbar;

figure; 
imagesc(sum3(abs(x1)));
title('sum of coeff gp norm');
colorbar;

figure;
imagesc(srec2);
title('reconstruction from L1 norm');
colorbar;


figure; 
imagesc(sum3(abs(x2)));
title('sum of coeff L1 norm');
colorbar;
